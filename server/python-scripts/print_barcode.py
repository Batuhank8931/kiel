import sys
import re
from zebra import Zebra

zpl_code_file = sys.argv[1]

with open(zpl_code_file, 'r') as file:
    barcode = file.read().strip()

if not barcode:
    print("Error: Barcode is empty")
    sys.exit(1)

if barcode.startswith('product'):
    match = re.search(r'(product)(\d+)', barcode)
    if match:
        header1 = "Product"
        header2 = f"-{match.group(2)}-"
    else:
        print("Error: Barcode format is invalid")
        sys.exit(1)
    font_size = "20"
elif barcode.startswith('UN'):
    header1 = "USER:"
    header2 = ""
    font_size = "30"
elif barcode.startswith('break'):
    header1 = ""
    header2 = "BREAK"
    font_size = "30"
else:
    header1 = "Unknown Barcode"
    header2 = ""
    font_size = "20"

print(f"Barcode received: {barcode}")
print(f"Header set to: {header1} {header2}")

# -------------------------
# HERE: Embed the GRF file
# -------------------------

grf_data = """
^GFA,4163,4163,23,
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000001DEEEEEEEEEEEEF0001000000000000000
0000000000001FFFFFFFFFFFFFF8043C00000000000000
0000000000003FFFFFFFFFFFFFF8067C00000000000000
0000000000003FFFFFFFFFFFFFF8066600000000000000
0000000000003FFFFFFFFFFFFFFC0CEC00000000000000
0000000000003FFFFFFFFFFFFFF807C400000000000000
0000000000003FFFFFFFFFFFFFF8038C00000000000000
0000000000001FFFFFFFFFFFFFF8000000000000000000
0000000000003FFFFFFFFFFFFFFC000A00000000000000
0000000000003FFFFFFFFFFFFFF8002C00000000000000
0000000000003FFFFFFFFFFFFFF800BC00000000000000
0000000000003FFFFFFFFFFFFFFC02F000000000000000
0000000000001FFFFFFFFFFFFFF807B800000000000000
0000000000000AAAAAAAAAAAFFF8079000000000000000
0000000000000000000000007FFC07F800000000000000
0000000000000000000000007FF800F000000000000000
0000000000000000000000007FF8001C00000000000000
0000000000000000000000003FFC001600000000000000
0000000000000000000000007FF8000000000000000000
00000000000000007FFFFFE07FF8030C00000000000000
0000000000000000FFFFFFE07FFC061C00000000000000
0000000000000000FFFFFFF07FF8060400000000000000
0000000000000001FFFFFFF07FF80C0E00000000000000
0000000000000000FFFFFFE07FFC060400000000000000
0000000000000001FFFFFFF07FF8060C00000000000000
0000000000000000FFFFFFF03FF8075C00000000000000
0000000000000000FFFFFFF07FF801F800000000000000
0000000000000001FFFFFFE07FFC014000000000000000
0000000000000000FFFFFFF07FF8000000000000000000
0000000000000000FFFFFFF07FF806FC00000000000000
0000000000000001FFFFFFF07FFC07FC00000000000000
0000000000000000FFFFFFE07FF8020000000000000000
0000000000000000FFF1FFF07FF8000400000000000000
0000000000000001FFF0FFF07FF803DC00000000000000
0000000000000000FFF0FFF07FFC07DC00000000000000
0000000000000000FFE0FFE07FF80C7000000000000000
0000000000000001FFF1FFF03FF8066000000000000000
0000000000000000FFE0FFF07FF804C000000000000000
0000000000000000FFF0FFE07FFC07FE00000000000000
0000000000000001FFF0FFF07FF807FC00000000000000
0000000000000000FFE0FFF07FF8000000000000000000
0000000000000000FFF0FFE07FF8064400000000000000
0000000000000001FFF0FFF07FFC0C6C00000000000000
0000000000000000FFE0FFF07FF8064600000000000000
0000000000000000FFF0FFE07FF804EC00000000000000
0000000000000001FFF0FFF07FF8076C00000000000000
0000000000000000FFE0FFF07FFC0FFC00000000000000
0000000000000000FFF0FFF07FF8000400000000000000
0000000000000001FFF0FFE07FF8001000000000000000
0000000000000000FFE0FFF07FF807FC00000000000000
0000000000000000FFF2FFF47FFC07EC00000000000000
0000000000000001FFFFFFFFFFF8079000000000000000
0000000000000000FFFFFFFFFFF801E000000000000000
0000000000000000FFFFFFFFFFF800E800000000000000
0000000000000001FFFFFFFFFFFC007000000000000000
0000000000000000FFFFFFFFFFF803D000000000000000
0000000000000000FFFFFFFFFFF807C400000000000000
0000000000000001FFFFFFFFFFF80FFC00000000000000
0000000000000000FFFFFFFFFFF802DC00000000000000
0000000000000001FFFFFFFFFFFC000000000000000000
0000000000000000FFFFFFFFFFF8000400000000000000
0000000000000000FFFFFFFFFFF8003C00000000000000
0000000000000001FFFFFFFFFFF800F400000000000000
0000000000000000FFFFFFFFFFF803F000000000000000
00000000000000003FFFFFFBFFFC071800000000000000
0000000000000000000000007FF80FB000000000000000
0000000000000000000000003FF801F800000000000000
0000000000000000000000007FF800F800000000000000
0000000000000000000000007FF8041C00000000000000
000000000000020010000084BFFC070400000000000000
0000000000000F807FFFFFFFFFF80F8000000000000000
0000000000001FC0FFFFFFFFFFF8079800000000000000
0000000000003FE0FFFFFFFFFFF8073C00000000000000
0000000000003FE1FFFFFFFFFFFC079C00000000000000
0000000000003FE0FFFFFFFFFFF8079C00000000000000
0000000000003FE1FFFFFFFFFFF80F9E00000000000000
0000000000001FC0FFFFFFFFFFF8073C00000000000000
0000000000003FE1FFFFFFFFFFFC079C00000000000000
0000000000003FE0FFFFFFFFFFF8079E00000000000000
0000000000003FE0FFFFFFFFFFF8079C00000000000000
0000000000003FE1FFFFFFFFFFF8073C00000000000000
0000000000001FC0FFFFFFFFFFFC079C00000000000000
0000000000001FC1FFFFFFFFFFF0000000000000000000
0000000000000680FFFFFFFFEED0000000000000000000
0000000000000000FFF000000000000000000000000000
0000000000000001FFE000000000000000000000000000
0000000000000000FFF000000000000000000000000000
0000000000000001FFE000000020000000000000000000
0000000000000000FFF0000000F8000000000000000000
0000000000000000FFE0000001F8000000000000000000
0000000000000001FFF0000003FC000000000000000000
0000000000000000FFE0000007F8000000000000000000
0000000000000001FFF000000FF8000000000000000000
0000000000000000FFF000001FF8000000000000000000
0000000000000000FFF800003FFC000000000000000000
0000000000000001FFFC00007FF8000000000000000000
0000000000000000FFFE0000FFF8000000000000000000
0000000000000001FFFF0001FFF8000000000000000000
0000000000000000FFFF8003FFF8000000000000000000
00000000000000007FFFC007F7F8000000000000000000
00000000000000007FFFE00FFFF8000000000000000000
00000000000000003FFFF01FFFF0000000000000000000
00000000000000000FFFF83FFFE0000000000000000000
00000000000000000FFFFC7FFFC0000000000000000000
000000000000000003FFFEFFFF80000000000000000000
000000000000000003FFFFFFFF00000000000000000000
000000000000000000FFFFFFFE00000000000000000000
000000000000000000FFFFFFFC00000000000000000000
0000000000000000003FFFFFF000000000000000000000
0000000000000000003FFFFFF000000000000000000000
0000000000000000000FFFFFD000000000000000000000
0000000000000000000FFFFFC000000000000000000000
00000000000000000003FFFF4000000000000000000000
00000000000000000003FFFF0000000000000000000000
00000000000000000000FFFE0000000000000000000000
00000000000000000000FFFE0000000000000000000000
00000000000001022492FFFE92A0000000000000000000
0000000000000FFFFFFFFFFFFFF0000000000000000000
0000000000001FFFFFFFFFFFFFF8000000000000000000
0000000000003FFFFFFFFFFFFFF8000000000000000000
0000000000003FFFFFFFFFFFFFF8000000000000000000
0000000000003FFFFFFFFFFFFFFC000000000000000000
0000000000003FFFFFFFFFFFFFF8000000000000000000
0000000000003FFFFFFFFFFFFFF8000000000000000000
0000000000001FFFFFFFFFFFFFF8000000000000000000
0000000000003FFFFFFFFFFFFFFC000000000000000000
0000000000003FFFFFFFFFFFFFF8000000000000000000
0000000000003FFFFFFFFFFFFFF8000000000000000000
0000000000003FFFFFFFFFFFFFF8000000000000000000
0000000000001FFFFFFFFFFFFFF8000000000000000000
00000000000007FFFFFF77777BA0000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000003018003000000000118000000000000000000
000000000701C003000000000218000000000000000000
0000000003000007000000000700000000000000000000
000000000339C7C3007C1E0F8FB9DE1FE01F0787738000
0000000007318F6300FE3F9FEF98FE1DC03F0FE7FFC000
000000000361CC6700C27188C619C639C0719C6738C000
0000000007E18D7315E86B85E718C730E060186618C000
0000000003E1DFF33E7E7F9EC619C630C070387738C000
0000000007B18C073E3E6058E738C730C060186618E000
000000000331CC0300073018C619C630E071186738C000
0000000007398E7301C6739DE718C739C6339CE618C000
000000000319C7E300FE3F9FC7B9C61FEE3F0FC738C000
000000000308838300380E0C6394C20EC41E070218C000
00000000000000000000000000000010C0000000000000
0000000000000000000000000000003AC0000000000000
0000000000000000000000000000001F80000000000000
0000000000000000000000000000000400000000000000
0000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000
0000000000044884000080008000012248804422201100
"""



zpl_code = f"""

^XA
^PW400
^LL300
^LH0,0
^LT20

^FO20,0
^BQN,2,8
^FDLA,{barcode}
^FS

^FO20,190
^A0,N,20,20
^FD{barcode}^FS

^FO200,0
^GB1,210,3^FS

^FO209,20
{grf_data}
^FS

^XZ
"""

z = Zebra('ZDesigner ZD220-203dpi ZPL')
z.output(zpl_code)
